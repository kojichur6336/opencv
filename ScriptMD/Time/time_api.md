# Time 功能接口文档


## 1. `Time.now()`

### 1.1 接口说明

`Time.now()` 用于 **获取当前高精度单调时间戳**（单位：毫秒，浮点数）。

说明：  
- 返回一个 **单调递增** 的时间戳（毫秒），**不受系统时间修改、时区变化、网络校时影响**  
- 该接口不表示“真实时间点”，而是用于**精确计时**

主要用于：  
- 代码耗时统计  
- 延时 / 睡眠精度测试  
- 单元测试中的时间对比与容差判断  

---

### 1.2 参数说明

无需参数

---

### 1.3 返回值说明

| 返回值 | 类型   | 中文说明                         | 示例          |
|--------|--------|----------------------------------|---------------|
| 时间戳 | number | 单调时间（毫秒，double 精度）   | `12345678.12` |

---

### 1.4 Lua 调用示例

#### 示例 1：基础耗时统计

```lua
local t1 = Time.now()
Time.sleep(1)
local t2 = Time.now()

Log.print('耗时: ' .. (t2 - t1) .. ' 毫秒')
```

---

## 2. `Time.sleep()`

### 2.1 接口说明

`Time.sleep(seconds)` 用于 **秒级休眠**，暂停脚本执行指定秒数（支持小数）。

常用于：  
- 脚本中等待  
- 定时任务  
- 测试和延时操作  

---

### 2.2 参数说明

| 参数位置 | 类型   | 是否必选 | 中文说明       | 示例 |
|----------|--------|----------|----------------|------|
| 第 1 个  | number | 是       | 暂停秒数，可为小数 | `2.5` |

---

### 2.3 返回值说明

该接口 **无返回值**。

---

### 2.4 Lua 调用示例

```lua
Time.sleep(2.5)
Log.print('暂停结束')
```

---


## 3. `Time.msleep()`

### 3.1 接口说明

`Time.msleep(milliseconds)` 用于 **毫秒级休眠**，暂停脚本执行指定毫秒数。

---

### 3.2 参数说明

| 参数位置 | 类型   | 是否必选 | 中文说明     | 示例 |
|----------|--------|----------|--------------|------|
| 第 1 个  | number | 是       | 暂停毫秒数   | `500` |

---

### 3.3 返回值说明

该接口 **无返回值**。

---

### 3.4 Lua 调用示例

```lua
Time.msleep(500)
Log.print('暂停 0.5 秒结束')
```

---


## 4. `Time.delay()`

### 4.1 接口说明

`Time.delay(milliseconds)` 用于 **延时操作**，逻辑同 `msleep`。

---

### 4.2 参数说明

| 参数位置 | 类型   | 是否必选 | 中文说明     | 示例 |
|----------|--------|----------|--------------|------|
| 第 1 个  | number | 是       | 延时毫秒数   | `100` |

---

### 4.3 返回值说明

该接口 **无返回值**。

---

### 4.4 Lua 调用示例

```lua
Time.delay(100)
Log.print('延时 100 毫秒结束')
```

---

## 5. `Time.systemTimeSeconds()`

### 5.1 接口说明

`Time.systemTimeSeconds()` 获取系统当前时间的 **Unix 时间戳（秒级，UTC）**。

常用于：  
- 时间戳计算  
- 本地系统时间记录  
- 时间偏差判断  

---

### 5.2 参数说明

该接口 **无需参数**。

---

### 5.3 返回值说明

| 调用形式                     | 返回值个数 | 返回类型 | 中文说明                |
|-------------------------------|------------|----------|------------------------|
| `Time.systemTimeSeconds()`    | 1          | integer  | 当前系统时间 Unix 秒级 |

---

### 5.4 Lua 调用示例

```lua
local sysTime = Time.systemTimeSeconds()
Log.print('当前系统时间: ' .. os.date('%Y-%m-%d %H:%M:%S', sysTime))
```

---


## 6. `Time.networkTime()`

### 6.1 接口说明

`Time.networkTime()` 获取 **精准网络时间**（秒级 Unix 时间戳），  
基于 NTP 协议修正，修正后的时间不受用户修改本地时间影响。

常用于：  
- 跨设备时间同步  
- 防作弊 / 脚本校准  
- 时间偏差监测  

---

### 6.2 参数说明

该接口 **无需参数**。

---

### 6.3 返回值说明

| 返回值位置 | 返回类型 | 中文说明 |
|------------|----------|----------|
| 第 1 个    | integer  | 修正后的网络时间（Unix 秒级） |
| 第 2 个    | boolean  | 是否同步成功，false 可能为本地时间 |

---

### 6.4 Lua 调用示例（完整测试示例）

```lua
local duration = 60
Log.print('====================================')
Log.print('🚀 网络时间对齐测试开始 (持续 1 分钟)')
Log.print('💡 提示：请在脚本运行期间手动修改系统时间进行测试')
Log.print('====================================')

for i = duration, 1, -1 do
    -- 获取本地系统时间
    local sysTime = Time.systemTimeSeconds()

    -- 获取网络精准时间及同步状态
    local netTime, isSynced = Time.networkTime()

    -- 计算偏差 (网络时间 - 系统时间)
    local offset = netTime - sysTime
    
    -- 构造状态图标
    local statusIcon = isSynced and '✅ [已同步]' or '⏳ [同步中]'

    -- 打印结果
    Log.print(string.format('倒计时: %02d 秒 %s', i, statusIcon))
    Log.print(string.format('  [系统时间]: %s (%d)', os.date('%Y-%m-%d %H:%M:%S', sysTime), sysTime))
    Log.print(string.format('  [网络时间]: %s (%d)', os.date('%Y-%m-%d %H:%M:%S', netTime), netTime))
    Log.print(string.format('  [当前偏差]: %d 秒', offset))
    Log.print('------------------------------------')

    -- 暂停 1 秒
    Time.sleep(1)
end

Log.print('====================================')
Log.print('🏁 测试结束')
Log.print('====================================')
```